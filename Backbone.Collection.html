<!DOCTYPE HTML>
<html>
<head>
    <meta charset="UTF-8">
    <title>BackboneJS - Collection</title>
</head>
<body>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script src="http://underscorejs.org/underscore-min.js"></script>
<script src="http://backbonejs.org/backbone-min.js"></script>
<script>
  // Your code goes here
  // Models, Views, Collections, routers and events
  // Backbone Collection - Set of models created by extending Backbone.Collection.
  
  var Todo = Backbone.Model.extend({  
	defaults: {
		id: 0,
		title: '',
		completed: false
	}  
  });
  
  var todo1 = new Todo({
	id: 4,
	title: 'first todo item',
	completed: false
  });
  
  var todo2 = new Todo({
    id: 5,
	title: 'second todo item',
	completed: false
  });
  
  var TodoCollection = Backbone.Collection.extend({
	model: Todo,
  });
  	  
  var todos = new TodoCollection([todo1, todo2]);  
  console.log("todos collection size: " + todos.length);
  
  var todo3 = new Todo({id: 6, title: 'third todo item', completed: false });
  todos.add(todo3);  
  console.log("After adding one more item - todos collections size: " + todos.length);
  
  todos.remove([todo1, todo2]);
  console.log("After removing two items - todos collections size: " + todos.length);

  todos.remove(todo3);
  console.log("After removing one item - todos collections size: " + todos.length);
  
  console.log("--------------------------------- Merge: true ------------------------------------------------");
  
  // Passing {merge: true}, causes duplicate models to have their attributes merged into the existing models, instead of being ignored.
  // Merge happens only if the id attribute is the same and the merge is set to true in the add operation.
  
  var todo5 = new Todo({id: 1, title: 'Read this book', completed: false});
  todos.add(todo5);
  
  var todo6 = new Todo({id: 1, title: 'Read this book 1', completed: true});
  todos.add(todo6, {merge: true});
  
  console.log(todos);
  
  console.log("--------------------------------- Retrieving Models ------------------------------------------------");
  
  // id, cid and idAttribute are properties of model to uniquely recognize them.
  // id is an unique identifier which is either string or integer.
  // cid is automaticaly generated by Backbone when model is created.
  // idAttribute - unique identifier of the model in server database.
  
  var retrievedtodo = todos.get(1);
  
  // Models are passed by reference
  console.log(todo5 == retrievedtodo);
  console.log(todo6 == retrievedtodo);
  
  console.log("--------------------------------- Listening for events ------------------------------------------------");
  
  todos.on("add", function(todo) {
	console.log("WOW - A new Todo is added :)");
  });
  todos.add(todo3);
 
  // Multiple events on data change can be subscribed this way.
  todos.on({"change:title": function(model) { console.log("title of a todo item has changed!"); },
			"change:completed": function(model) { console.log("completed attribute of a todo item has changed"); }	
  });
  
  var myTodo = todos.get(6);
  myTodo.set("title", "new title set");
  myTodo.set("completed", true);
  
  console.log("---------------------------------- Resetting/Refreshing Collections ---------------------------------------------");
  // Updating the collection at once is done using set function.
  
  var collection = new Backbone.Collection();
  
  collection.add([
	{ id: 1, title: 'Sourcebits' },
	{ id: 2, title: 'Samsung' }
  ]);

  collection.on({
	"change:title": function() { console.log("title changed"); },
    "add": function() { console.log("added"); },
	"remove": function() { console.log("removed"); }
  });
  
  collection.set([
	{ id: 1, title: 'Samsung' },
	{ id: 3, title: 'Microsoft' }
  ]);
 
  console.log("collection size: " + collection.length);
  
  // reset event is fired on collection without any add/removed events.
  // On reset event fire, you will have access to previous deleted models at options.previousModels.
  collection.reset();
  
  console.log("collection size after reset: " + collection.length);
 
</script>
</body>
</html>